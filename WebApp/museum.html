
<html>
<head>

	<link rel="stylesheet" href="web/css1.css" type="text/css" media="screen, projection">

	<script src="https://kit.fontawesome.com/c41d189736.js" crossorigin="anonymous"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>



    <script type="text/javascript">

		var ascending = false;
	

		function sortTablePop() {
		console.log("sorting");
		  var table, rows, switching, i, x, y, shouldSwitch;
		  table = document.getElementById("TabPop");
		  switching = true;
		  /*Make a loop that will continue until
		  no switching has been done:*/
			if (ascending == false) {
				ascending = true;
			} else {
				ascending = false;
			}


			if (ascending == true) {

				while (switching) {
					//start by saying: no switching is done:
					switching = false;
					rows = table.rows;
					/*Loop through all table rows (except the
					first, which contains table headers):*/
					for (i = 1; i < (rows.length - 1); i++) {
					//start by saying there should be no switching:
					shouldSwitch = false;
					/*Get the two elements you want to compare,
					one from current row and one from the next:*/
					x = rows[i].getElementsByTagName("TD")[3];
					y = rows[i + 1].getElementsByTagName("TD")[3];
					//check if the two rows should switch place:
					if (Number(x.innerHTML) < Number(y.innerHTML)) {
						//if so, mark as a switch and break the loop:
						shouldSwitch = true;
						break;
					}
					}
					if (shouldSwitch) {
					/*If a switch has been marked, make the switch
					and mark that a switch has been done:*/
					rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
					switching = true;
					}
				}
			} else {

		  while (switching) {
			//start by saying: no switching is done:
			switching = false;
			rows = table.rows;
			/*Loop through all table rows (except the
			first, which contains table headers):*/
			for (i = 1; i < (rows.length - 1); i++) {
			  //start by saying there should be no switching:
			  shouldSwitch = false;
			  /*Get the two elements you want to compare,
			  one from current row and one from the next:*/
			  x = rows[i].getElementsByTagName("TD")[3];
			  y = rows[i + 1].getElementsByTagName("TD")[3];
			  //check if the two rows should switch place:
			  if (Number(x.innerHTML) > Number(y.innerHTML)) {
				//if so, mark as a switch and break the loop:
				shouldSwitch = true;
				break;
			  }
			}
			if (shouldSwitch) {
			  /*If a switch has been marked, make the switch
			  and mark that a switch has been done:*/
			  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			  switching = true;
			}
		  }
			}
	}

	function prova1() {			//Displays the last hour values for temperature from both devices

		var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
			var currentTime = new Date().getTime();
			var olderTime = currentTime - 3600000;

	var xhttp = new XMLHttpRequest();			//First Get Request to get temperature telemetries from first device; it needs device ID, keys, and the time interval (from currentTime - 3600000 to currentTime )
	xhttp.open('GET', 'http://cloud.thingsboard.io/api/plugins/telemetry/ASSET/757d9cc0-95bf-11ea-b94b-4b8eb8a38a67/values/timeseries?keys=avgAsseX,avgAsseY,avgAsseZ,isRunning&startTs='+ olderTime + '&endTs=' + currentTime + '&limit=60&agg=AVG');
	xhttp.setRequestHeader('Content-Type', 'application/json');
	xhttp.setRequestHeader('X-Authorization', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJzdXBlcmFzZEBsaXZlLml0Iiwic2NvcGVzIjpbIlRFTkFOVF9BRE1JTiJdLCJ1c2VySWQiOiI1NzQ1NzFlMC05NDY4LTExZWEtYjk0Yi00YjhlYjhhMzhhNjciLCJmaXJzdE5hbWUiOiJBbmRyZWEiLCJsYXN0TmFtZSI6IkZlcnJhcmEiLCJlbmFibGVkIjp0cnVlLCJwcml2YWN5UG9saWN5QWNjZXB0ZWQiOnRydWUsImlzUHVibGljIjpmYWxzZSwidGVuYW50SWQiOiI1NzMyZDQ0MC05NDY4LTExZWEtYjk0Yi00YjhlYjhhMzhhNjciLCJjdXN0b21lcklkIjoiMTM4MTQwMDAtMWRkMi0xMWIyLTgwODAtODA4MDgwODA4MDgwIiwiaXNzIjoiY2xvdWQudGhpbmdzYm9hcmQuaW8iLCJpYXQiOjE1ODkyOTg3MDIsImV4cCI6MTU5MTA5ODcwMn0.uSgMsReC1xj_FcTYRzUEvF_9Xe4QhZGUnfyLKP4U2ghEk7YU9bFKKV6JqdStrco2gPodYV58XqESVMmelGXtNQ'); //X-Authorization to access thingsboard account
	xhttp.send();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			var response = JSON.parse(this.responseText);
			var prova = response.avgAsseX;
			console.log(prova[0].value);					

		}

			

	}

};


        function popularityFunction() {			//Displays the last hour values for temperature from both devices

			var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
			var currentTime = new Date().getTime();
			var olderTime = currentTime - 3600000;

            var xhttp = new XMLHttpRequest();			//First Get Request to get temperature telemetries from first device; it needs device ID, keys, and the time interval (from currentTime - 3600000 to currentTime )
			xhttp.open('GET', 'http://demo.thingsboard.io/api/plugins/telemetry/DEVICE/0324b2e0-6ad0-11ea-ad02-b3576b7d39f1/values/timeseries?keys=temperature,device&startTs='+ olderTime + '&endTs=' + currentTime + '&limit=60&agg=AVG');
			xhttp.setRequestHeader('Content-Type', 'application/json');
			xhttp.setRequestHeader('X-Authorization', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhbmRyZXc5NmZlcnJhcmFAaG90bWFpbC5pdCIsInNjb3BlcyI6WyJSRUZSRVNIX1RPS0VOIl0sInVzZXJJZCI6ImQ4NDIyNzEwLTZhY2YtMTFlYS04ZTBhLTdkMGVmMmE2ODJkMyIsImlzUHVibGljIjpmYWxzZSwiaXNzIjoidGhpbmdzYm9hcmQuaW8iLCJqdGkiOiI5M2E2MzZiMi05Mjg4LTQxOTctODFmNS04NzlmMzU0MTRiZjQiLCJpYXQiOjE1ODkxODk5MTAsImV4cCI6MTYyNTE4OTkxMH0.xdThntp0cBDE2QSsm6Mb8bBzU4ZTrNAD9gnRICnJN5Kia2dZDFkDcK5-Uv0NJQb9SaZwyNoRFquGopBeeA6SXA'); //X-Authorization to access thingsboard account
			xhttp.send();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var response = JSON.parse(this.responseText);

					//storing parsed results in corresponding vectors, so we can access the data.
					var temp = response.temperature;		
					var dev = response.device;

					for (var i = 0; i < temp.length; i++) {			//For cycle to build TabTemp table.

							var table = document.getElementById("TabPop");

							var row = table.insertRow();

							var cell0 = row.insertCell(0);
							var cell1 = row.insertCell(1);
							var cell2 = row.insertCell(2);
							var cell3 = row.insertCell(3);

								var date = new Date(temp[i].ts);
								var year = date.getFullYear();
								var month = months[date.getMonth()];
								var day = date.getDate();
								// Hours part from the timestamp
								var hours = date.getHours();
								// Minutes part from the timestamp
								var minutes = date.getMinutes();
								// Seconds part from the timestamp
								var seconds = date.getSeconds();
								var milliseconds = date.getMilliseconds();

								// Will display timestamp in a human-friendly format
								var formattedTime = day + " " + month + " " + year + " " + hours + ' : ' + minutes + 'm : ' + seconds + "s : " + milliseconds + "ms";
								
								cell0.innerHTML = Number(temp[i].ts);
								cell1.innerHTML = formattedTime;
								cell2.innerHTML = Number(temp[i].value).toFixed(2) + "°";
								cell3.innerHTML = dev[i].value;

						}

						console.log(response);					

				}

			};


			var xhttp2 = new XMLHttpRequest();			//Second Get Request to get temperature telemetries from second device; it needs device ID, keys, and the time interval (from currentTime - 336000000 to currentTime )
			xhttp2.open('GET', 'http://demo.thingsboard.io/api/plugins/telemetry/DEVICE/032c2cf0-6ad0-11ea-ad02-b3576b7d39f1/values/timeseries?keys=temperature,device&startTs='+ olderTime + '&endTs=' + currentTime + '&limit=60&agg=AVG');
			xhttp2.setRequestHeader('Content-Type', 'application/json');
			xhttp2.setRequestHeader('X-Authorization', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhbmRyZXc5NmZlcnJhcmFAaG90bWFpbC5pdCIsInNjb3BlcyI6WyJURU5BTlRfQURNSU4iXSwidXNlcklkIjoiZDg0MjI3MTAtNmFjZi0xMWVhLThlMGEtN2QwZWYyYTY4MmQzIiwiZmlyc3ROYW1lIjoiQW5kcmVhIiwibGFzdE5hbWUiOiJGZXJyYXJhIiwiZW5hYmxlZCI6dHJ1ZSwicHJpdmFjeVBvbGljeUFjY2VwdGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiZDgwNDVhYzAtNmFjZi0xMWVhLThlMGEtN2QwZWYyYTY4MmQzIiwiY3VzdG9tZXJJZCI6IjEzODE0MDAwLTFkZDItMTFiMi04MDgwLTgwODA4MDgwODA4MCIsImlzcyI6InRoaW5nc2JvYXJkLmlvIiwiaWF0IjoxNTg2NTM0ODkyLCJleHAiOjE1ODgzMzQ4OTJ9.tuhh-UfBGHfy5PhAUvoy0vQFTxa3nMvQUlAMWAwRbH6NU3aQ3kK1cICEZrGZn-RppJmEfAE8yIxRtfjEXo2AjA');
			xhttp2.send();
			xhttp2.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var response = JSON.parse(this.responseText);

					//storing parsed results in corresponding vectors, so we can access the data.
					var temp = response.temperature;
					var dev = response.device;

					for (var i = 0; i < temp.length; i++) {			//For cycle to build TabTemp table.

							var table = document.getElementById("TabPop");

							var row = table.insertRow();

							var cell0 = row.insertCell(0);
							var cell1 = row.insertCell(1);
							var cell2 = row.insertCell(2);
							var cell3 = row.insertCell(3);

								var date = new Date(temp[i].ts);
								var year = date.getFullYear();
								var month = months[date.getMonth()];
								var day = date.getDate();
								// Hours part from the timestamp
								var hours = date.getHours();
								// Minutes part from the timestamp
								var minutes = date.getMinutes();
								// Seconds part from the timestamp
								var seconds = date.getSeconds();
								var milliseconds = date.getMilliseconds();

								// Will display timestamp in a human-friendly format
								var formattedTime = day + " " + month + " " + year + " " + hours + ' : ' + minutes + 'm : ' + seconds + "s : " + milliseconds + "ms";

								cell0.innerHTML = Number(temp[i].ts);
								cell1.innerHTML = formattedTime;
								cell2.innerHTML = Number(temp[i].value).toFixed(2) + "°";
								cell3.innerHTML = dev[i].value;

					}

						console.log(response);

				}

			};


		}

	

    </script>

</head>
<body onload="popularityFunction();" style="margin: 0px;">	<!-- On page load, execute funcions -->


<div id="header" style="width: 100%; height: 300px;">
	<!-- <a href="#TabTemp"><i class="fas fa-temperature-high fa-2x"></i></a>
	<a href="#TabHum"><i style="top: 45px" class="fas fa-tint fa-2x"></i></a>
	<a href="#TabDir"><i style="top: 95px" class="fas fa-arrow-right fa-2x"></i></a>
	<a href="#TabInt"><i style="top: 150px" class="fas fa-smog fa-2x"></i></a>
	<a href="#TabRain"><i style="top: 205px" class="fas fa-cloud-rain fa-2x"></i></a>
	<a href="#TabRiot"><i style="top: 255px" class="fas fa-registered fa-2x"></i></a>
	<a href="#header"><i id="up" style="position:fixed; bottom:30px; left: 50px" class="fas fa-chevron-circle-up fa-4x"></i></a> -->
	

	<h1 style="position: absolute;
    left: 35%;
    top: 100px;
    color: wheat;
    text-shadow: 2px 2px black;">Arte Classica Museum - Popularity Ranking Control Panel</h1><!-- 
	<img style="width: 100%; position: inherit; height: inherit;" src="web/museo.jpg"> -->
</div>

<ul>
	<li><a class="active" href="#home">Home</a></li>
	<li><a href="#history">History</a></li>
	<li><a href="#info">Info</a></li>
	<li><a href="#about">About</a></li>
</ul>

<div style="left: 15%; position: absolute; top: 650px; margin: 10px;">


	<h3 style="text-align: center; position: relative;"> Popularity Table <button onclick="sortTablePop()">Sort by Position</button></h3>				<!--TabTemp and sortTableT button-->

	<table id="TabPop">
		<tr>
			<th>Statue Id</th>
			<th>Popularity Value</th>
			<th>Average Visit</th>
			<th>Position</th>
		</tr>
		<tr>
			<td>Statue Id</th>
			<td>Popularity Value</th>
			<td>Average Visit</th>
			<td>1</th>
		</tr>
		<tr>
			<td>Statue Id</th>
			<td>Popularity Value</th>
			<td>Average Visit</th>
			<td>2</th>
		</tr>
	</table>

</div>

</body>
</html>
